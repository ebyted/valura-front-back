# Habilitar módulo de seguridad para Apache en Docker
LoadModule unixd_module modules/mod_unixd.so
LoadModule dir_module modules/mod_dir.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule headers_module modules/mod_headers.so 
# Puerto de escucha estándar para Apache
Listen 80
# Habilitar módulo de logs para CustomLog
LoadModule log_config_module modules/mod_log_config.so
# Cargar el módulo MPM necesario para Apache
LoadModule mpm_event_module modules/mod_mpm_event.so

# Usar usuario y grupo por defecto del contenedor Apache
User www-data
Group www-data

# Configuración de logs estándar para Docker
ErrorLog /proc/self/fd/2
CustomLog /proc/self/fd/1 common
# DocumentRoot correcto para servir el sitio
DocumentRoot "/usr/local/apache2/htdocs"
DirectoryIndex index.html

<Directory "/usr/local/apache2/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

# Habilita mod_proxy y mod_proxy_http
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so

# Proxy para /api hacia el backend
ProxyPass /api http://localhost:3015/
ProxyPassReverse /api http://localhost:3015/
# Incluir archivos de configuración adicionales
IncludeOptional conf.d/*.conf

# Configuración CORS para /api/cotizacion
<IfModule mod_headers.c>
    <Location /api/cotizacion>
        Header always set Access-Control-Allow-Origin "https://valura.mx https://www.valura.mx http://localhost http://127.0.0.1"
        Header always set Access-Control-Allow-Methods "POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "Content-Type"
        Header always set Access-Control-Allow-Credentials "true"
        SetEnvIf Request_Method OPTIONS is_options
        Header always set Access-Control-Max-Age "86400" env=is_options
    </Location>
</IfModule>



